<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheito Company</title>
    <link rel="stylesheet" type="text/css" href="css/estiloRegistro.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha256-…" crossorigin="anonymous" />
</head>
<body>

<header>
    <div class="encabezado">
        <h1>Cheito Company</h1>
        <p>Registro de Controladores</p>
        <nav class="menu">
            <a href="index.html">Pagina Principal</a>
            <a href="informacion.html">Información</a>
            <a href="contactos.html">Contactos</a>
            <a href="registro.html">Registrar Controladores</a>
        </nav>
    </div>

    <div class="container">
        <div class="formulario">
            <h2>Ingreso de datos</h2>
            
            <form>
                <label for="codigo">Codigo:</label>
                <input type="text" id="codigo" required>

                <label for="marca">Marca:</label>
                <input type="text" id="marca" required>

                <label for="telefono">Especificaciones:</label>
                <input type="tel" id="especificaciones" required>

                <label for="fecha_fabrica">Fecha y Año de Fabricación:</label>
                <input type="date" id="fecha_fabrica" required>

                <label for="detalles">Detalles:</label>
                <input type="text" id="detalles" required>

                <button type="button" onclick="guardar()">Guardar</button>
            </form>

            <table class="table-container">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Marca</th>
                        <th>Especificaciones</th>
                        <th>Fecha y Año de Fabricación</th>
                        <th>Detalles</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tabla-body"></tbody>
            </table>
        </div>

        <div class="img-formulario">
            <img src="img/escucha.png" alt="Descripción de la imagen" style="width: 400px; height: 400px; align-items: left;">
        </div>
    </div>

    <ul id="registrar"></ul>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update, child } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAYYHfHIO3GjsNFLJ1DoNzqjWAr21ZoEVg",
            authDomain: "proyecto-falcon25.firebaseapp.com",
            databaseURL: "https://proyecto-falcon25-default-rtdb.firebaseio.com",
            projectId: "proyecto-falcon25",
            storageBucket: "proyecto-falcon25.appspot.com",
            messagingSenderId: "897557394941",
            appId: "1:897557394941:web:a995638cdfb6b7e1735594"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const listaRegistro = document.getElementById("registrar");

        function actualizarLista() {
            listaRegistro.innerHTML = ""; // Limpiar la lista antes de actualizar

            const controladoresRef = ref(database, 'controladoresDJ');

            onValue(controladoresRef, (snapshot) => {
                const datos = snapshot.val();

                for (let key in datos) {
                    const controlador = datos[key];

                    const li = document.createElement("li");
                    li.textContent = `Código: ${controlador.codigo}, Marca: ${controlador.marca}, Especificaciones: ${controlador.especificaciones}, Fecha de Fabricación: ${controlador.fecha_fabrica}, Detalles: ${controlador.detalles}`;

                    const editarButton = document.createElement("button");
                    editarButton.textContent = "Editar";
                    editarButton.onclick = () => editar(key, controlador);
                    li.appendChild(editarButton);

                    const eliminarButton = document.createElement("button");
                    eliminarButton.textContent = "Eliminar";
                    eliminarButton.onclick = () => eliminar(key);
                    li.appendChild(eliminarButton);

                    listaRegistro.appendChild(li);
                }
            });
        }

        window.guardar = function () {
            const codigo = document.getElementById("codigo").value;
            const marca = document.getElementById("marca").value;
            const especificaciones = document.getElementById("especificaciones").value;
            const fecha_fabrica = document.getElementById("fecha_fabrica").value;
            const detalles = document.getElementById("detalles").value;
            
            push(
                ref(database, 'controladoresDJ'),
                {
                    codigo: codigo,
                    marca: marca,
                    especificaciones: especificaciones,
                    fecha_fabrica: fecha_fabrica,
                    detalles: detalles
                }
            );

            document.getElementById('codigo').value = '';
            document.getElementById('marca').value = '';
            document.getElementById('especificaciones').value = '';
            document.getElementById('fecha_fabrica').value = '';
            document.getElementById('detalles').value = '';

            actualizarLista(); // Actualizar la lista después de guardar
        }

        window.editar = function (key, controlador) {
            const nuevoCodigo = prompt("Nuevo Código:", controlador.codigo);
            const nuevaMarca = prompt("Nueva Marca:", controlador.marca);
            const nuevasEspecificaciones = prompt("Nuevas Especificaciones:", controlador.especificaciones);
            const nuevaFechaFabrica = prompt("Nueva Fecha de Fabricación:", controlador.fecha_fabrica);
            const nuevosDetalles = prompt("Nuevos Detalles:", controlador.detalles);

            update(child(ref(database, 'controladoresDJ'), key), {
                codigo: nuevoCodigo,
                marca: nuevaMarca,
                especificaciones: nuevasEspecificaciones,
                fecha_fabrica: nuevaFechaFabrica,
                detalles: nuevosDetalles
            });

            actualizarLista(); // Actualizar la lista después de editar
        }

        window.eliminar = function (key) {
            const confirmacion = confirm("¿Estás seguro de que deseas eliminar este registro?");
            if (confirmacion) {
                remove(child(ref(database, 'controladoresDJ'), key));
                actualizarLista(); // Actualizar la lista después de eliminar
            }
        };

        onValue(ref(database, 'controladoresDJ'), (snapshot) => {
            renderizarTabla(snapshot.val());
        });

        function renderizarTabla(controladores) {
            const tablaBody = document.getElementById('tabla-body');
            tablaBody.innerHTML = "";

            for (const key in controladores) {
                if (Object.hasOwnProperty.call(controladores, key)) {
                    const controlador = controladores[key];

                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                        <td>${controlador.codigo}</td>
                        <td>${controlador.marca}</td>
                        <td>${controlador.especificaciones}</td>
                        <td>${controlador.fecha_fabrica}</td>
                        <td>${controlador.detalles}</td>
                        <td>
                            <button onclick="editar('${key}', ${JSON.stringify(controlador)})">Editar</button>
                            <button onclick="eliminar('${key}')">Eliminar</button>
                        </td>
                    `;

                    tablaBody.appendChild(fila);
                }
            }
        }

        // Actualizar la lista al cargar la página
        actualizarLista();
    </script>
</body>
</html>
